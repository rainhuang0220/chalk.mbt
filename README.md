# chalk.mbt
实现一个功能与 Node.js 的 chalk 等价的MoonBit 终端着色与样式库

## 当前进度

- 已完成基础项目结构搭建和配置文件设置
- 实现了核心终端着色功能，包括基本颜色（红、绿、蓝等）和样式（粗体等）
- 开发了颜色支持检测系统，可以识别终端颜色支持级别
- 创建了模块化的代码组织，包含核心实现、API定义和工具函数
- 完成了基本功能测试，验证了着色功能正常工作

项目目前处于持续开发和完善阶段，正在逐步实现更多高级功能。

## chalk-todolist



## 阶段一：项目初始化与基础准备（1-2 周）

1. **环境搭建**

- 安装最新稳定版的 MoonBit 编译器

- 学习 MoonBit 的基础语法和模块系统

- 熟悉 MoonBit 的包管理和构建流程

1. **项目初始化**

- 创建名为chalk.mbt的仓库

- 设置基础的项目结构：

```
chalk.mbt/
├── src/
│   ├── core/        # 核心功能实现
│   ├── api/         # API定义
│   ├── utils/       # 工具函数
│   └── main.mbt     # 入口文件
├── tests/           # 测试用例
├── examples/        # 示例代码
└── README.md        # 项目文档
```

1. **学习参考资料**

- 研究 chalk 库的工作原理

- 理解 ANSI 转义码的基本概念和用法

- 学习终端颜色支持的相关知识（0/16/256/16m 级别）

## 阶段二：核心功能实现（2-3 周）

1. **ANSI 转义码基础实现**

- 创建映射表，将样式（如红色、粗体）映射到对应的 ANSI 转义码

- 实现基础的样式包裹函数：接收文本和样式，返回带 ANSI 码的文本

1. **基础 API 设计**

- 定义基础样式 API 的接口：

- 文本颜色：red, green, blue 等

- 背景颜色：bgRed, bgGreen 等

- 文本样式：bold, italic, underline 等

- 实现简单的函数调用方式：chalk_red("text")

1. **链式调用支持**

- 设计支持链式调用的数据结构

- 实现链式调用逻辑：chalk.red.bold("text")

- 处理样式的组合与优先级

## 阶段三：高级功能开发（3-4 周）

1. **颜色能力检测**

- 实现终端颜色支持级别检测功能

- 处理环境变量：NO_COLOR, FORCE_COLOR 等

- 实现 TTY 检测与自动降级逻辑

1. **扩展颜色 API**

- 实现 rgb (), hex (), hsl () 等颜色函数

- 实现对应的背景色函数：bgRgb (), bgHex () 等

- 处理颜色级别降级：如 16m 颜色在只支持 256 色的终端上的转换

1. **模板字符串支持**

- 实现模板标签解析器

- 支持嵌套样式：`chalk.tag{red error: {bold ${message}}} `

- 实现转义逻辑：{{/}}转义为{或}

## 阶段四：完善与优化（2-3 周）

1. **样式覆盖与重置**

- 实现样式嵌套和交错的正确处理

- 优化重置码，避免 "色彩泄漏"

- 处理复杂样式组合的边界情况

1. **辅助函数实现**

- 实现 stripAnsi ()：移除文本中的 ANSI 转义码

- 实现 visibleWidth ()：计算文本的可视宽度

- 实现 supportsColor ()：返回终端颜色支持信息

1. **跨平台兼容性**

- 测试并适配 Linux/macOS/Windows 终端

- 特别处理 PowerShell/Windows Terminal 的兼容性

- 确保在不同环境下的表现一致

## 阶段五：工具化与发布准备（1-2 周）

1. **CLI 示例**

- 开发mb-chalk-demo工具

- 展示各种样式和终端支持的颜色级别

1. **文档完善**

- 编写详细的 API 文档

- 提供使用示例和最佳实践

- 说明兼容性和已知限制

1. **测试与优化**

- 编写单元测试和集成测试

- 进行性能测试和优化

- 确保线程安全和无全局状态

1. **发布准备**

- 准备发布到 Mooncakes

- 配置 CI 流程

- 编写发布说明

## 每周具体任务建议

### 第 1 周：

- 完成项目初始化

- 学习 MoonBit 基础和 ANSI 转义码

- 实现最基础的红色文本输出功能

### 第 2 周：

- 实现所有 16 色的文本和背景色

- 实现基础文本样式（bold, italic 等）

- 编写简单的测试用例

### 第 3 周：

- 实现链式调用功能

- 处理样式组合

- 开始实现颜色能力检测的基础部分

### 第 4 周：

- 完善颜色能力检测

- 实现 256 色支持

- 开始处理环境变量逻辑

### 第 5 周：

- 实现 16m (truecolor) 支持

- 开发 rgb (), hex (), hsl () 等 API

- 实现颜色降级逻辑

### 第 6 周：

- 实现模板字符串支持

- 处理嵌套和转义

- 优化样式组合逻辑

### 第 7 周：

- 实现样式覆盖与重置

- 开发辅助函数

- 进行跨平台测试

### 第 8 周：

- 开发 CLI 演示工具

- 完善文档

- 进行全面测试和优化

### 第 9 周：

- 修复发现的问题

- 准备发布材料

- 配置 CI 流程

### 第 10 周：

- 最终测试和优化

- 发布到 Mooncakes

- 总结项目经验

## 验证节点

在每个阶段结束时，设置一些可验证的目标：

1. 阶段一结束：能够编译通过并输出 "Hello World"

1. 阶段二结束：能够使用基础 API 和链式调用输出带颜色和样式的文本

1. 阶段三结束：支持所有颜色格式和模板字符串，能正确检测终端颜色能力

1. 阶段四结束：所有辅助函数工作正常，跨平台测试通过

1. 阶段五结束：CLI 工具正常工作，文档完整，测试覆盖率达标

